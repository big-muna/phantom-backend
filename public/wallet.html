<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phantom Wallet Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.umd.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 2rem;
  color: #f8fafc;
  overflow-x: hidden;
}

/* ---------------- Navigation ---------------- */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(0,0,0,0.2);
  backdrop-filter: blur(15px);
  padding: 1rem 2rem;
  border-radius: 1rem;
  margin-bottom: 2rem;
}
.navbar .logo { font-weight: 700; font-size: 1.5rem; color: #fff; }
.navbar .nav-links { display: flex; gap: 1.5rem; }
.navbar .nav-links a { color: #f8fafc; text-decoration: none; font-weight: 500; transition: 0.3s; }
.navbar .nav-links a:hover { color: #a855f7; }
.hamburger { display: none; font-size: 1.5rem; cursor: pointer; color: #fff; }
@media (max-width:768px){
  .navbar .nav-links { position: absolute; top: 80px; right: 1rem; flex-direction: column; background: rgba(0,0,0,0.3); padding: 1rem 1.5rem; border-radius: 0.8rem; display: none; }
  .navbar .nav-links.active { display: flex; }
  .hamburger { display: block; }
}

.container { max-width: 1400px; margin: 0 auto; position: relative; z-index: 2; }
h1 { text-align: center; font-size: 2.5rem; margin-bottom: 0.5rem; text-shadow: 0 4px 20px rgba(0,0,0,0.3); }
.subtitle { text-align: center; margin-bottom: 2rem; opacity: 0.9; }

/* Tabs */
.tab-navigation { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
.tab-btn { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border: 1px solid rgba(124,58,237,0.3); color: #f8fafc; padding: 0.8rem 1.5rem; border-radius: 0.7rem; cursor: pointer; transition: 0.3s; font-size: 1rem; }
.tab-btn:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); }
.tab-btn.active { background: linear-gradient(135deg,#7c3aed,#a855f7); border-color: #a855f7; box-shadow: 0 8px 25px rgba(124,58,237,0.4); }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.4s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Action Bar */
.action-bar { display: flex; justify-content: flex-end; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
.action-btn { background: linear-gradient(135deg,#7c3aed,#a855f7); color: #fff; border: none; padding: 0.8rem 1.5rem; border-radius: 0.7rem; cursor: pointer; transition: 0.3s; font-size: 0.95rem; font-weight: 600; }
.action-btn:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(124,58,237,0.5); }
.action-btn.secondary { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border: 1px solid rgba(124,58,237,0.3); }

/* Wallet Grid */
.wallet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

/* Wallet Card */
.wallet-card { background: rgba(255,255,255,0.08); backdrop-filter: blur(15px); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(124,58,237,0.2); transition: 0.3s; position: relative; overflow: hidden; }
.wallet-card:hover { transform: translateY(-5px); box-shadow: 0 20px 50px rgba(124,58,237,0.4); }
.wallet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
.wallet-icon { font-size: 2.5rem; }
.wallet-status { display: flex; align-items: center; gap: 0.5rem; }
.status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
.status-dot.connected { background: #10b981; box-shadow: 0 0 10px #10b981; }
.status-dot.disconnected { background: #ef4444; box-shadow: 0 0 10px #ef4444; }
.status-dot.warning { background: #f59e0b; box-shadow: 0 0 10px #f59e0b; }
@keyframes pulse { 0%,100%{opacity:1;}50%{opacity:0.5;} }
.wallet-name { font-size: 1.3rem; font-weight: 600; margin-bottom: 0.3rem; color: #a855f7; cursor: pointer; }
.wallet-name[contenteditable]:focus { outline: 1px dashed #fff; }
.wallet-type { font-size: 0.85rem; opacity: 0.7; margin-bottom: 1rem; }
.wallet-balance { background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.7rem; margin-bottom: 1rem; }
.balance-amount { font-size: 1.8rem; font-weight: 700; margin-bottom: 0.3rem; }
.balance-fiat { font-size: 0.9rem; opacity: 0.7; }
.wallet-address { display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.05); padding: 0.7rem; border-radius: 0.5rem; margin-bottom: 1rem; font-family: monospace; font-size: 0.85rem; }
.address-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.copy-btn { background: rgba(124,58,237,0.3); border: none; padding: 0.4rem 0.7rem; border-radius: 0.4rem; color: #fff; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
.copy-btn:hover { background: rgba(124,58,237,0.5); }
.wallet-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.wallet-action-btn { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(124,58,237,0.3); color: #fff; padding: 0.6rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: 0.3s; font-size: 0.85rem; }
.wallet-action-btn:hover { background: rgba(124,58,237,0.3); transform: translateY(-2px); }
.wallet-action-btn.danger { border-color: rgba(239,68,68,0.5); }
.wallet-action-btn.danger:hover { background: rgba(239,68,68,0.3); }
.security-badge { position: absolute; top: 1rem; right: 1rem; background: rgba(239,68,68,0.2); border: 1px solid rgba(239,68,68,0.5); padding: 0.3rem 0.7rem; border-radius: 0.4rem; font-size: 0.75rem; font-weight: 600; }
.security-badge.verified { background: rgba(16,185,129,0.2); border-color: rgba(16,185,129,0.5); }

/* Recent Activity */
.activity-section { margin-top: 2rem; }
.section-title { font-size: 1.5rem; margin-bottom: 1rem; color: #e0e7ff; }
.activity-list { background: rgba(255,255,255,0.08); backdrop-filter: blur(15px); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(124,58,237,0.2); }
.activity-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid rgba(124,58,237,0.1); transition: 0.2s; }
.activity-item:last-child { border-bottom: none; }
.activity-item:hover { background: rgba(255,255,255,0.05); border-radius: 0.5rem; }
.activity-icon { font-size: 1.5rem; margin-right: 1rem; }
.activity-details { flex: 1; }
.activity-title { font-weight: 600; margin-bottom: 0.2rem; }
.activity-time { font-size: 0.85rem; opacity: 0.7; }
.activity-amount { font-weight: 700; font-size: 1.1rem; }
.activity-amount.positive { color: #10b981; }
.activity-amount.negative { color: #ef4444; }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 1000; align-items: center; justify-content: center; padding: 2rem; }
.modal.active { display: flex; animation: fadeIn 0.3s ease-in; }
.modal-content { background: rgba(102,126,234,0.95); backdrop-filter: blur(20px); border-radius: 1rem; padding: 2rem; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; border: 1px solid rgba(124,58,237,0.3); box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
.modal-title { font-size: 1.5rem; font-weight: 600; }
.close-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; font-size: 1.5rem; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
.close-btn:hover { background: rgba(255,255,255,0.2); transform: rotate(90deg); }

/* Form */
.form-group { margin-bottom: 1rem; }
.form-group label { display: block; margin-bottom: 0.4rem; font-weight: 500; font-size: 0.9rem; }
.form-group input, .form-group select, .form-group textarea { width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(124,58,237,0.3); border-radius: 0.6rem; padding: 0.8rem; color: #f8fafc; font-family: inherit; font-size: 0.95rem; transition: 0.3s; }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #a855f7; box-shadow: 0 0 15px rgba(168,85,247,0.5); background: rgba(255,255,255,0.15); }
.form-group input::placeholder, .form-group textarea::placeholder { color: rgba(248,250,252,0.5); }
.form-group textarea { resize: vertical; min-height: 80px; }
.submit-btn-modal { width: 100%; background: linear-gradient(135deg,#7c3aed,#a855f7); color: #fff; border: none; padding: 1rem; border-radius: 0.7rem; cursor: pointer; transition: 0.3s; font-size: 1rem; font-weight: 600; margin-top: 1rem; }
.submit-btn-modal:hover { transform: scale(1.02); box-shadow: 0 10px 30px rgba(124,58,237,0.5); }

/* Verification Cards */
.verification-methods { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem; }
.verification-method { flex: 1; background: linear-gradient(135deg,#a855f7,#7c3aed); padding: 0.8rem 1rem; border-radius: 0.7rem; cursor: pointer; text-align: center; transition: 0.3s; font-weight: 600; }
.verification-method:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
.verification-method.active { border: 2px solid #fff; }

/* Responsive */
@media (max-width: 768px) {
  body { padding: 1rem; }
  h1 { font-size: 1.8rem; }
  .wallet-grid { grid-template-columns: 1fr; }
  .action-bar { flex-direction: column; }
  .action-btn { width: 100%; }
  .modal-content { padding: 1.5rem; }
}

/* Notifications */
.notification { position: fixed; top: 2rem; right: 2rem; background: rgba(16,185,129,0.95); color: white; padding: 1rem 1.5rem; border-radius: 0.7rem; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: none; z-index: 2000; animation: slideIn 0.4s ease-out; }
.notification.show { display: block; }
.notification.error { background: rgba(239,68,68,0.95); }
@keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
</style>
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
  <div class="logo">üí∞ Phantom Wallet</div>
  <div class="hamburger" onclick="toggleNav()">‚ò∞</div>
  <div class="nav-links" id="navLinks">
    <a href="/dashboard">Dashboard</a>
    <a href="/wallet">Wallets</a>
    <a href="/setting">Settings</a>
  </div>
</nav>

<div class="notification" id="notification"></div>

<div class="container">
  <h1>üíº Wallet Management Dashboard</h1>
  <p class="subtitle">Manage all your crypto wallets, track balances, and withdraw funds</p>

  <!-- Tabs -->
  <div class="tab-navigation">
    <button class="tab-btn active" onclick="switchTab('overview')">Wallet Overview</button>
    <button class="tab-btn" onclick="switchTab('activity')">Recent Activity</button>
    <button class="tab-btn" onclick="switchTab('security')">Security & Audit</button>
  </div>

  <!-- Wallet Overview -->
  <div id="overview" class="tab-content active">
    <div class="action-bar">
      <button class="action-btn secondary" onclick="refreshWallets()">üîÑ Refresh All</button>
      <button class="action-btn" onclick="openModal('addWallet')">‚ûï Add Wallet</button>
    </div>
    <div class="wallet-grid" id="walletGrid"></div>
  </div>

  <!-- Recent Activity -->
  <div id="activity" class="tab-content">
    <div class="section-title">üìä Recent Wallet Activity</div>
    <div class="activity-list" id="activityList"></div>
  </div>

  <!-- Security & Audit -->
  <div id="security" class="tab-content">
    <div class="section-title">üîí Security Overview</div>
    <div class="audit-log" id="auditLog"></div>
  </div>
</div>

<!-- Modals (Add & Withdraw) -->
<div id="addWalletModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Add New Wallet</h2>
      <button class="close-btn" onclick="closeModal('addWallet')">√ó</button>
    </div>
    <form onsubmit="addWallet(event)">
      <div class="form-group">
        <label>Wallet Type</label>
        <select name="walletType" required>
          <option value="">Select wallet type</option>
          <option value="MetaMask">MetaMask</option>
          <option value="Trust Wallet">Trust Wallet</option>
          <option value="Ledger">Ledger (Hardware)</option>
          <option value="Trezor">Trezor (Hardware)</option>
          <option value="Exodus">Exodus</option>
          <option value="Binance">Binance Exchange</option>
        </select>
      </div>
      <div class="form-group">
        <label>Wallet Name</label>
        <input type="text" name="walletName" placeholder="My Main Wallet" required>
      </div>
      <div class="form-group">
        <label>Wallet Address / Connection Details</label>
        <textarea name="connectionDetails" placeholder="Enter private key, seed phrase, or connection details..." required></textarea>
      </div>
      <div class="verification-box">
        <div class="verification-title">üîê Security Verification Required</div>
        <div class="verification-methods">
          <div class="verification-method active" onclick="selectVerification(this)">üìß Email</div>
          <div class="verification-method" onclick="selectVerification(this)">üì± SMS</div>
          <div class="verification-method" onclick="selectVerification(this)">üîë 2FA</div>
        </div>
        <div class="form-group" style="margin-top:1rem;">
          <label>Verification Code</label>
          <input type="text" name="verificationCode" placeholder="Enter 6-digit code" maxlength="6" required>
        </div>
      </div>
      <button type="submit" class="submit-btn-modal">Add Wallet</button>
    </form>
  </div>
</div>

<div id="withdrawModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Withdraw Funds</h2>
      <button class="close-btn" onclick="closeModal('withdraw')">√ó</button>
    </div>
    <form onsubmit="withdrawFunds(event)">
      <input type="hidden" name="walletId" id="withdrawWalletId">
      <div class="form-group">
        <label>Recipient Wallet Address</label>
        <input type="text" name="recipient" placeholder="0x..." required>
      </div>
      <div class="form-group">
        <label>Amount</label>
        <input type="number" step="0.0001" name="amount" placeholder="0.0" required>
      </div>
      <div class="form-group">
       <label>Your Email</label>
        <input type="email" name="email" placeholder="Enter your email" required>
        </div>
      <div class="verification-methods">
        <div class="verification-method active" onclick="selectWithdrawalVerification(this)">üìß Email</div>
        <div class="verification-method" onclick="selectWithdrawalVerification(this)">üîë 2FA</div>
      </div>
      <div class="form-group" style="margin-top:1rem;">
        <label>Verification Code</label>
        <input type="text" name="verificationCode" placeholder="Enter 6-digit code" maxlength="6" required>
        <input type="hidden" name="walletId" id="withdrawWalletId">
      </div>
      <button type="submit" class="submit-btn-modal">Withdraw</button>
    </form>
  </div>
</div>

<script>
let wallets = [
  {id:'w1',name:'Main Wallet',type:'MetaMask',icon:'ü¶ä',address:'0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb',balance:'0',fiatValue:'$0',status:'connected',securityVerified:true},
  {id:'w2',name:'Hardware Storage',type:'Ledger',icon:'üîê',address:'0x8f3Cf7ad23Cd3CaDbD9735AFF958023239c6A063',balance:'0',fiatValue:'$0',status:'connected',securityVerified:true},
  {id:'w3',name:'Trading Account',type:'Binance',icon:'ü™ô',address:'binance_user_12345',balance:'0',fiatValue:'$0',status:'connected',securityVerified:true},
  {id:'w4',name:'Mobile Wallet',type:'Trust Wallet',icon:'üì±',address:'0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984',balance:'0',fiatValue:'$0',status:'connected',securityVerified:true}
];

let selectedVerificationMethod = 'Email';
let selectedWithdrawalMethod = 'Email';

// ---------------- UI Helpers ----------------
function toggleNav() { document.getElementById('navLinks').classList.toggle('active'); }
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById(tab).classList.add('active');
}
function openModal(modal) { document.getElementById(modal+'Modal').classList.add('active'); }
function closeModal(modal) { document.getElementById(modal+'Modal').classList.remove('active'); }
function selectVerification(el) {
  document.querySelectorAll('#addWalletModal .verification-method').forEach(m => m.classList.remove('active'));
  el.classList.add('active');
  selectedVerificationMethod = el.textContent.trim();
}
function selectWithdrawalVerification(el) {
  document.querySelectorAll('#withdrawModal .verification-method').forEach(m => m.classList.remove('active'));
  el.classList.add('active');
  selectedWithdrawalMethod = el.textContent.trim();
}
function showNotification(msg, error=false) {
  const n = document.getElementById('notification');
  n.textContent = msg;
  n.className = 'notification show'+(error?' error':'');
  setTimeout(()=>n.classList.remove('show'),3000);
}
function copyToClipboard(text) { navigator.clipboard.writeText(text); showNotification('Address copied!'); }

// ---------------- Wallet Management ----------------
function renderWallets() {
  const grid = document.getElementById('walletGrid');
  grid.innerHTML = '';
  wallets.forEach(w=>{
    const card = document.createElement('div');
    card.className='wallet-card';
    card.innerHTML=`
      <div class="wallet-header">
        <div class="wallet-icon">${w.icon}</div>
        <div class="wallet-status"><div class="status-dot ${w.status}"></div>${w.status}</div>
      </div>
      <div class="wallet-name" contenteditable="true" onblur="renameWallet('${w.id}', this.textContent)">${w.name}</div>
      <div class="wallet-type">${w.type}</div>
      <div class="wallet-balance">
        <div class="balance-amount">${w.balance}</div>
        <div class="balance-fiat">${w.fiatValue}</div>
      </div>
      <div class="wallet-address">
        <div class="address-text">${w.address}</div>
        <button class="copy-btn" onclick="copyToClipboard('${w.address}')">Copy</button>
      </div>
      <div class="wallet-actions">
        <button class="wallet-action-btn" onclick="openWithdrawModal('${w.id}')">Withdraw</button>
        <button class="wallet-action-btn danger" onclick="removeWallet('${w.id}')">Remove</button>
      </div>
      <div class="security-badge ${w.securityVerified?'verified':''}">${w.securityVerified?'Verified':'Attention'}</div>
    `;
    grid.appendChild(card);
  });
}

function renameWallet(id,name){const w=wallets.find(w=>w.id===id);if(w){w.name=name;showNotification('Wallet renamed!');}}
function refreshWallets(){wallets.forEach(w=>w.lastSync=new Date()); renderWallets(); showNotification('Wallets refreshed!');}
function addWallet(e){
  e.preventDefault(); 
  const f=e.target; 
  const id='w'+Date.now(); 
  wallets.push({
    id,
    name:f.walletName.value,
    type:f.walletType.value,
    icon:f.walletType.value==='MetaMask'?'ü¶ä':f.walletType.value==='Ledger'?'üîê':f.walletType.value==='Trust Wallet'?'üì±':'ü™ô',
    address:f.connectionDetails.value,
    balance:'0.00',
    fiatValue:'$0.00',
    status:'connected',
    securityVerified:true
  }); 
  renderWallets(); 
  closeModal('addWallet'); 
  showNotification('Wallet added!');
}
function removeWallet(id){wallets=wallets.filter(w=>w.id!==id); renderWallets(); showNotification('Wallet removed!');}
function openWithdrawModal(id){document.getElementById('withdrawWalletId').value=id; openModal('withdraw');}

// ---------------- Blockchain Wallet Sync ----------------
async function syncAllWallets() {
  const provider = new ethers.JsonRpcProvider("https://mainnet.infura.io/v3/YOUR_INFURA_KEY");
  for (let w of wallets) {
    try {
      // Only attempt blockchain fetch for Ethereum addresses (0x...)
      if (w.address.startsWith('0x')) {
        const balanceBigInt = await provider.getBalance(w.address);
        const ethBalance = parseFloat(ethers.formatEther(balanceBigInt));
        w.balance = ethBalance.toFixed(4);
      }
    } catch(err) {
      console.error("Failed to fetch balance for", w.name);
    }
  }
  renderWallets();
}

// ---------------- Withdrawal Flow ----------------
async function withdrawFunds(e) {
  e.preventDefault();
  const f = e.target;
  const walletId = f.walletId.value;
  const recipient = f.recipient.value.trim();
  const amount = parseFloat(f.amount.value);
  const code = f.verificationCode.value.trim();
  const email = f.email.value.trim();

  if (!email) return showNotification("Please enter your email.", true);
  if (!recipient || !amount) return showNotification("Please fill all fields.", true);

  const wallet = wallets.find(w => w.id === walletId);
  if (!wallet) return showNotification("Wallet not found", true);

  // ---------------- Sync individual wallet from blockchain ----------------
  try {
    if (wallet.address.startsWith('0x')) {
      const provider = new ethers.JsonRpcProvider("https://mainnet.infura.io/v3/YOUR_INFURA_KEY");
      const balanceBigInt = await provider.getBalance(wallet.address);
      const ethBalance = parseFloat(ethers.formatEther(balanceBigInt));
      wallet.balance = ethBalance.toFixed(4);
    }
  } catch(err) {
    console.error(err);
    return showNotification("Failed to fetch wallet balance from blockchain", true);
  }

  if (amount > wallet.balance) return showNotification("Insufficient balance", true);

  // ---------------- Step 1: Request verification code if empty ----------------
  if (!code) {
    const url = selectedWithdrawalMethod === "Email" ? "/api/withdraw-request" : "/api/request-2fa";
    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, walletId, amount, recipient })
      });
      const data = await res.json();
      if (res.ok) {
        showNotification("Check your email for the verification code.");
      } else {
        showNotification(data.message || "Failed to send verification code.", true);
      }
    } catch(err) {
      showNotification("Server error. Try again later.", true);
    }
    return; // Stop until code is entered
  }

  // ---------------- Step 2: Verify code & process withdrawal ----------------
  const verifyUrl = selectedWithdrawalMethod === "Email" ? "/api/verify-withdrawal" : "/api/verify-2fa";
  try {
    const res2 = await fetch(verifyUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, code })
    });
    const data2 = await res2.json();
    if (!res2.ok) return showNotification(data2.message || "Verification failed.", true);

    wallet.balance = (wallet.balance - amount).toFixed(4);
    renderWallets();
    closeModal("withdraw");
    showNotification("Withdrawal successful!");
  } catch(err) {
    showNotification("Server error. Try again later.", true);
  }
}

// ---------------- Initial Render & Sync ----------------
renderWallets();
syncAllWallets(); // Auto-fetch balances on page load
</script>
</body>
</html>
