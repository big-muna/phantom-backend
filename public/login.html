<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phantom Recovery - Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ---------------- Reset & Base ---------------- */
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); color:#f8fafc; overflow-x:hidden; }
body { padding:2rem; position:relative; }

/* ---------------- Animated Background ---------------- */
.bg-animation{position:fixed;inset:0;z-index:0;pointer-events: none;}
.floating-shape{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.3;animation:float 20s infinite ease-in-out;}
.shape1{width:400px;height:400px;background:radial-gradient(circle, rgba(124,58,237,0.4), transparent);top:-200px;left:-200px;}
.shape2{width:350px;height:350px;background:radial-gradient(circle, rgba(236,72,153,0.4), transparent);bottom:-150px;right:-150px;}
@keyframes float{0%,100%{transform:translate(0,0) scale(1);}33%{transform:translate(30px,-30px) scale(1.1);}66%{transform:translate(-20px,20px) scale(0.9);}}

/* ---------------- Login Container ---------------- */
.login-container{
  position:relative; z-index:2;
  max-width:450px; width:100%; margin:0 auto;
  background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
  border:1px solid rgba(124,58,237,0.3); border-radius:1.5rem;
  padding:3rem 2rem; box-shadow:0 20px 60px rgba(0,0,0,0.4);
  animation:slideIn 0.8s ease;
}
@keyframes slideIn{from{opacity:0; transform:translateY(30px);}to{opacity:1; transform:translateY(0);}}

/* ---------------- Header ---------------- */
.login-header{text-align:center;margin-bottom:2rem;}
.login-title{font-size:2.5rem;font-weight:700;margin-bottom:0.5rem;
  background: linear-gradient(135deg,#7c3aed,#a855f7,#ec4899);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  animation: gradientFlow 3s infinite; background-size:200% 200%;}
@keyframes gradientFlow{0%,100%{background-position:0% 50%;}50%{background-position:100% 50%;}}
.login-subtitle{color:#94a3b8;font-size:1rem;}

/* ---------------- Form ---------------- */
.form-group{margin-bottom:1.5rem;}
.form-label{display:block;margin-bottom:0.5rem;color:#cbd5e1;font-weight:500;font-size:0.9rem;}
.form-label span{color:#ef4444;}
.input-wrapper{position:relative;}
.input-icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:#94a3b8;font-size:1.1rem;}
.form-input{
  width:100%;padding:1rem 1rem 1rem 3rem;
  background: rgba(255,255,255,0.2); border:1px solid rgba(124,58,237,0.3); border-radius:0.5rem;
  color:#f8fafc;font-size:1rem; transition:all 0.3s ease;
}
.form-input:focus{outline:none;border-color:#a855f7;box-shadow:0 0 20px rgba(168,85,247,0.3);background: rgba(255,255,255,0.25);}
.form-input.error{border-color:#ef4444;}
.form-input.success{border-color:#10b981;}
.password-toggle{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:none;color:#94a3b8;cursor:pointer;font-size:1.1rem;transition:color 0.3s;}
.password-toggle:hover{color:#a855f7;}

/* ---------------- Checkbox ---------------- */
.checkbox-group{display:flex;align-items:center;margin-bottom:1.5rem;}
.checkbox-input{margin-right:0.5rem; accent-color:#7c3aed;}
.checkbox-label a{color:#7c3aed; text-decoration:none;}
.checkbox-label a:hover{text-decoration:underline;}

/* ---------------- Buttons ---------------- */
.submit-btn{
  width:100%; padding:1rem; border:none; border-radius:0.5rem;
  background:#7c3aed; color:#fff; font-size:1rem; cursor:pointer; transition:all 0.3s;
}
.submit-btn:hover{background:#a855f7;}

/* ---------------- Social Buttons ---------------- */
.social-buttons{
  display:flex; justify-content:space-between; margin-top:1rem;
}
.social-btn{
  flex:1; margin:0 0.25rem; padding:0.75rem 0; border-radius:0.5rem;
  color:#fff; text-align:center; font-size:1.2rem; transition:all 0.3s;
}
.social-btn.google{background:#db4437;}
.social-btn.facebook{background:#3b5998;}
.social-btn.instagram{background:#e4405f;}
.social-btn.apple{background:#000;}
.social-btn:hover{opacity:0.8;}
.social-divider{text-align:center;color:#94a3b8;margin:1.5rem 0;}

/* ---------------- Links ---------------- */
.forgot-link, .register-link{display:block;text-align:right;color:#94a3b8;margin-top:0.5rem;font-size:0.9rem;}
.forgot-link a, .register-link a{color:#7c3aed;text-decoration:none;}
.forgot-link a:hover, .register-link a:hover{text-decoration:underline;}

/* ---------------- Error Messages ---------------- */
.error-message{
  color:#fff; background:rgba(239,68,68,0.85);
  padding:0.5rem 0.75rem; border-radius:0.5rem;
  font-size:0.85rem; margin-top:0.5rem; display:none;
}
.error-message.show{display:block; animation:shake 0.3s;}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}

/* ---------------- Success Modal ---------------- */
.success-modal{
  display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7);
  z-index:10; justify-content:center; align-items:center;
}
.success-modal.show{display:flex;}
.success-content{
  background: rgba(255,255,255,0.15); backdrop-filter: blur(15px);
  padding:2rem; border-radius:1rem; text-align:center; color:#f8fafc;
}
.success-icon{font-size:3rem; margin-bottom:1rem; color:#10b981;}
.success-btn{margin-top:1rem;padding:0.75rem 2rem;border:none;border-radius:0.5rem;background:#7c3aed;color:#fff;cursor:pointer;}
.success-btn:hover{background:#a855f7;}

/* ---------------- Responsive Adjustments ---------------- */
@media (max-width:500px){
  body{padding:1rem;}
  .login-container{padding:2rem 1rem; border-radius:1rem; box-shadow:0 10px 40px rgba(0,0,0,0.4);}
  .login-title{font-size:2rem;}
  .login-subtitle{font-size:0.9rem;}
  .form-input{padding:0.8rem 1rem 0.8rem 2.5rem; font-size:0.95rem;}
  .password-toggle{font-size:1rem;}
  .submit-btn{padding:0.9rem; font-size:0.95rem;}
  .social-buttons{flex-direction:column;}
  .social-btn{margin:0.25rem 0; font-size:1rem; padding:0.6rem 0;}
  .forgot-link, .register-link{text-align:center; font-size:0.85rem; margin-top:0.75rem;}
}
</style>
</head>
<body>

<div class="bg-animation">
  <div class="floating-shape shape1"></div>
  <div class="floating-shape shape2"></div>
</div>

<div class="login-container">
  <div class="login-header">
    <h1 class="login-title">Login</h1>
    <p class="login-subtitle">Access your Phantom Recovery account</p>
  </div>

  <form id="loginForm">
    <div class="form-group">
      <label class="form-label">Email or Username <span>*</span></label>
      <div class="input-wrapper">
        <i class="fas fa-user input-icon"></i>
        <input type="text" class="form-input" id="loginUser" placeholder="Email or Username" required>
      </div>
      <div class="error-message" id="loginUserError">Please enter your email or username</div>
    </div>

    <div class="form-group">
      <label class="form-label">Password <span>*</span></label>
      <div class="input-wrapper">
        <i class="fas fa-lock input-icon"></i>
        <input type="password" class="form-input" id="loginPassword" placeholder="Password" required>
        <button type="button" class="password-toggle" id="toggleLoginPassword"><i class="fas fa-eye"></i></button>
      </div>
      <div class="error-message" id="loginPasswordError">Please enter your password</div>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" class="checkbox-input" id="rememberMe">
      <label class="checkbox-label" for="rememberMe">Remember Me</label>
    </div>

    <a href="/pass" class="forgot-link">Forgot Password?</a>

   <div id="loginMessage" class="error-message"></div>
<button type="submit" class="submit-btn">
  <i class="fas fa-sign-in-alt"></i> Login
</button>

    <div class="social-divider"><span>Or login with</span></div>
    <div class="social-buttons">
      <a href="#" class="social-btn google"><i class="fab fa-google"></i></a>
      <a href="#" class="social-btn facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="#" class="social-btn instagram"><i class="fab fa-instagram"></i></a>
      <a href="#" class="social-btn apple"><i class="fab fa-apple"></i></a>
    </div>

    <div class="register-link">Don't have an account? <a href="/register">Register here</a></div>
  </form>
</div>

<div class="success-modal" id="successModal">
  <div class="success-content">
    <div class="success-icon"><i class="fas fa-check"></i></div>
    <h3>Login Successful!</h3>
    <p>Welcome back to Phantom Recovery!</p>
    <button class="success-btn" onclick="closeModal()">Continue</button>
  </div>
</div>

<script>
// ---------------- Password Toggle ----------------
function togglePassword(inputId, toggleId) {
  const input = document.getElementById(inputId);
  const icon = document.getElementById(toggleId).querySelector('i');
  if (input.type === 'password') {
    input.type = 'text';
    icon.classList.replace('fa-eye', 'fa-eye-slash');
  } else {
    input.type = 'password';
    icon.classList.replace('fa-eye-slash', 'fa-eye');
  }
}
document.getElementById('toggleLoginPassword')?.addEventListener('click', () =>
  togglePassword('loginPassword', 'toggleLoginPassword')
);

// ---------------- DOM Elements ----------------
const loginForm = document.getElementById('loginForm');
const loginMessage = document.getElementById('loginMessage');
const successModal = document.getElementById('successModal');

// ---------------- Error & Success Handlers ----------------
function showError(msg) {
  loginMessage.textContent = msg;
  loginMessage.classList.add('show');
}

function hideError() {
  loginMessage.textContent = '';
  loginMessage.classList.remove('show');
}

function showSuccessModal() {
  successModal.classList.add('show');
}

function closeModal() {
  successModal.classList.remove('show');
}
window.closeModal = closeModal; // Make accessible from HTML

// ---------------- Login Form Submit ----------------
loginForm.addEventListener('submit', async function(e){
  e.preventDefault();
  hideError();

  const emailField = document.getElementById('loginUser');
  const passField = document.getElementById('loginPassword');

  // --- Field Validation ---
  let valid = true;
  if (!emailField.value.trim()) {
    document.getElementById('loginUserError').classList.add('show');
    valid = false;
  } else {
    document.getElementById('loginUserError').classList.remove('show');
  }
  if (!passField.value.trim()) {
    document.getElementById('loginPasswordError').classList.add('show');
    valid = false;
  } else {
    document.getElementById('loginPasswordError').classList.remove('show');
  }
  if (!valid) return;

  // --- Login Request ---
  const payload = {
    email: emailField.value.trim(),
    password: passField.value.trim()
  };

  try {
    const res = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (res.ok && data.success) {
      // Save user info
      localStorage.setItem('userId', data.userId);
      localStorage.setItem('role', data.role);

      // Show success modal and redirect
      showSuccessModal();
      setTimeout(() => {
        if (data.role === 'client') window.location.href = '/dashboard';
        else if (data.role === 'admin') window.location.href = '/admin';
        else window.location.href = '/';
      }, 1500);
    } else {
      showError(data.message || 'Login failed. Check credentials.');
    }
  } catch(err) {
    console.error('Login error:', err);
    showError('Cannot connect to server. Try again later.');
  }
});

// ---------------- Social Buttons ----------------
document.querySelectorAll('.social-btn').forEach(btn => {
  btn.addEventListener('click', function(e){
    e.preventDefault();
    let platform = btn.classList.contains('google') ? 'Google' :
                   btn.classList.contains('facebook') ? 'Facebook' :
                   'Instagram';
    alert(`Redirecting to ${platform} login...`);
  });
});
</script>
</body>
</html>
